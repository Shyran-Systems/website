{% extends "base.html" %}
{% load static %}

{% block content %}

    <link rel="stylesheet" type="text/css" href="{% static 'pipeline/pipeline.css' %}" />
    {% load app_filters %}

    <div class="white-board-back">
        <div class="white-board">
            <div class="container">
               <h1>{{pipeline.name}}</h1>
               <p>{{ pipeline.description|linebreaksbr}}</p>
            </div>

            {% for pipe in pipeline.pipe_set.all %}
               <div class="input-output-container">
                   <div class="container">
                       <div class="input{{pipe.id}}">
                           {% include 'pipeline/input.html' %}
                      </div>
                       {% comment %}
                       Create js vars that will passed to script
                       {%  endcomment %}
                       <script type="text/javascript" src="{% static 'pipeline/run_input.js' %}"></script>
                       <script>
                              var form_id = {{'.form'|strcat:pipe.id|js}};
                              var pipe_id = {{pipe.id|js}};
                              var host = '{{pipe.request.component.host}}';
                              var base_path = '{{pipe.request.component.base_path}}';
                              var request_path = '{{pipe.request.path}}';
                              request_path = request_path.slice(1);
                              var request_name = '{{pipe.request.name}}';

                              var rest_url = '{% url 'rest:request' %}';
                              var request_data = {};
                              var data = {
                                     {% for k, v in pipe.parameters.items %}
                                     "{{ k }}": "{{ v }}"{% if not forloop.last %},{% endif %}
                                     {% endfor %}
                                 };

                              request_data['data'] = {{ pipe.parameters|js}};
                              request_data['url'] = host+base_path+request_path+'/'+request_name;
                              request_data['type'] = {{pipe.request.type|js}};
                              run_form(form_id, pipe_id, rest_url, request_data)
                       </script>
                   </div>
                   <div class="container">
                       <div class="output{{pipe.id}}">
                           {% include 'pipeline/output.html' %}
                       </div>
                   </div>
               </div>
            {% endfor %}
        </div>>
    </div>

{% endblock %}
