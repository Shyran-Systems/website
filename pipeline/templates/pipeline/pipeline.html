{% extends "base.html" %}
{% load static %}

{% block content %}

    <link rel="stylesheet" type="text/css" href="{% static 'pipeline/pipeline.css' %}" />

    <div class="white-board-back">
        <div class="white-board">
            <div class="container">
               <h1>{{pipeline.name}}</h1>
               <p>{{ pipeline.description|linebreaksbr}}</p>
            </div>

            {% for pipe in pipeline.pipe_set.all %}
               <div class="input-output-container">
                   <div class="container">
                       <div class="pipe row">
                                <div class="col-xs-1 col-sm-1">{{ pipe.pk }}</div>
                                <div class="col-xs-11 col-sm-11 input">

                                    <form class='my-ajax-form' method='POST' action='.' data-url='{{ request.build_absolute_uri|safe }}'>
                                            {% csrf_token %}
                                        <textarea cols="40" rows="5" name="input">{{ pipe.input }}</textarea>
                                        <input type='hidden' name="pipe_id" value="{{ pipe.pk }}" />
                                        <button class="btn btn-outline-secondary" name="run" type="submit" value="run">run</button>
                                    </form>

                                </div>
                                <div class="time-run">Run at: {{ pipe.run_time }}</div>
                       </div>
                   </div>
                   <div class="container">
                       <div class="pipe row">
                                <div class="col-xs-1 col-sm-1"></div>
                                <div class="col-xs-11 col-sm-11 output">{{ pipe.output| safe  }}</div>
                                <div class="time-received">Received at: {{ pipe.output_time }}</div>
                        </div>
                   </div>
               </div>
            {% endfor %}
        </div>>
    </div>

{% endblock %}


{% block javascript %}
    <script>
        $(document).ready(function(){
            var $myForm = $('.my-ajax-form')
            $myForm.submit(function(event){
                event.preventDefault()
                var $formData = $(this).serialize()
                var $thisURL = $myForm.attr('data-url') || window.location.href // or set your own url
                $.ajax({
                    method: "POST",
                    url: $thisURL,
                    data: $formData,
                    success: handleFormSuccess,
                    error: handleFormError,
                })
            })

            function handleFormSuccess(data, textStatus, jqXHR){

                console.log('data:')
                console.log(data)
                console.log('status:')
                console.log(textStatus)
                console.log('jqXHR:')
                console.log(jqXHR)
            }

            function handleFormError(jqXHR, textStatus, errorThrown){
                console.log(jqXHR)
                console.log(textStatus)
                console.log(errorThrown)
            }
        })
    </script>
{% endblock %}
